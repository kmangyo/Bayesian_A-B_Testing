# Bayesian A/B testing
### Bayesian A/B testing in Shiny App.

- [Shiny App](https://khg423.shinyapps.io/A_B_Testing/)에서 사용해 볼 수 있습니다.
- 이 shiny app의 아이디어는 [David Robinson의 포스팅](http://varianceexplained.org/r/bayesian_ab_baseball/)과 [COUNT BAYESIE의 포스팅] (https://www.countbayesie.com/blog/2015/4/25/bayesian-ab-testing)에 기반하였습니다.

- 일반적으로 광고의 CTR(Click through rate)이나 CVR(Conversion rate)를 비교할 때, 한 경우의 케이스가 다른 경우보다 사건횟수가 적어서 비교하기 모호한 경우가 있습니다.
- 예를 들어, A케이스는 클릭 100번에 인스톨이 5번이라 인스톨 CVR이 5%고, B케이스는 클릭 1,000번에 40번 인스톨이라 인스톨 CVR이 4%인 경우가 있습니다. 그렇다면 사건 발생이 상대적으로 적었던 A케이스의 CVR 5%가 사건 발생이 많았던 B케이스의 CVR 4%보다 정말 좋은 성과를 나타낸 것일까요?
- 이런 상황에서 베이지안 분석을 적용하면, 사용자가 사전 Beta를 정의해 주고 비교하고 싶은 사건 (ex. 인스톨/클릭, 클릭/노출)의 횟수를 입력하여 A/B 케이스를 비교할 수 있습니다.

- 위에서 언급한 케이스를 예시로 사용하면 아래와 같습니다.
- 먼저, 사전 확률을 입력합니다. 일반적으로 광고운영에서 클릭대비 인스톨이 10%를 넘어가는 경우는 거의 없기 때문에, prior beta에서 beta1은 1, beta2는 9로 입력하였습니다 (보통 bata0, alpha0로 표기합니다.). 그러므로 prior beta는 Beta(1,9)입니다. 나머지 클릭 수와 인스톨 수는 위의 예시 대로 입력하였습니다.

![사용자 입력](https://dl.dropboxusercontent.com/u/1049842/%EB%B8%94%EB%A1%9C%EA%B7%B8/A_B_testing/input.png)

- 그러면 아래와 같이 A가 B보다 CVR이 높을 확률을 계산해 줍니다.
- 결과 값이 50%면 높을 확률 반 낮을 확률 반이기 때문에 거의 유사하다는 의미입니다. 실제 분석 결과를 살펴보면, A의 CVR이 B보다 높을 확률이 71.3%로 나타났습니다. 이는 그다지 높은 확률은 아닙니다. 즉, 케이스 A의 CVR 5%가 B의 4%보다 명백히 더 좋다고 말하기 어렵습니다.

```
$Result
[1] "71.2%"

$A
[1] "5%"

$B
[1] "4%"
```

- 아래는 위에서 계산된 A/B 케이스의 CVR을 Beta distribution에 따라 그린 분포입니다. 이를 통해 시각적으로 두 CVR의 차이를 확인할 수 있습니다.
- 아래 그림을 보면, 사건횟수 적었던 A가 사건횟수가 많았던 B보다 더 넓은 분포를 나타내는걸 확인할 수 있습니다. 그리고 두케이스의 분포가 겹치는 부분도 많습니다. 이를 통해 차이가 크지 않다는 걸 시각적으로 확인할 수 있습니다.

![Density Plot](https://dl.dropboxusercontent.com/u/1049842/%EB%B8%94%EB%A1%9C%EA%B7%B8/A_B_testing/density.png)

- 베이지안 접근의 장점중 하나는 효과의 유의성 뿐 아니라, 그 크기를 확인할 수 있다는 점입니다.
- 두 케이스의 CVR을 Beta distribution에 따라 시뮬레이션한 값을 비교하여 그 크기를 확인할 수 있습니다.
- 아래 결과를 보면, 40% 값이 대략 1.151정도 입니다. 이는 A가 B보다 1.15배 좋을 확율이 60%라는 의미입니다. 60% 값은 1.434정도인데 이는 A가 B보다 1.4배 좋을 확률이 40%라는 의미입니다.

```
        Impact
10%  0.7035792
20%  0.8753253
30%  1.0170273
40%  1.1512797
50%  1.2875144
60%  1.4342028
70%  1.6055581
80%  1.8238089
90%  2.1618528
100% 7.3409547
```

- 위의 결과를 종합하모면, 광고 A가 B보다 CVR이 높다고 평가할 수 있는 확률도 낮지만, 그 차이의 크기 역시 상당히 낮은 것을 확인 할 수 있습니다.
